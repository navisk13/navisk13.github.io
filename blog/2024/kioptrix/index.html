<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Kioptrix - Vulnhub (TCM Security Version) | Navaneeth Sivakumar </title> <meta name="author" content="Navaneeth Sivakumar"> <meta name="description" content="A walkthrough of the machine “Kioptrix” on Vulnhub."> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A7%91%E2%80%8D%F0%9F%92%BB&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://navisk13.github.io/blog/2024/kioptrix/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Navaneeth</span> Sivakumar </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Kioptrix - Vulnhub (TCM Security Version)</h1> <p class="post-meta"> June 22, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/ctf-walkthrough"> <i class="fa-solid fa-hashtag fa-sm"></i> ctf-walkthrough</a>   <a href="/blog/tag/exam-prep"> <i class="fa-solid fa-hashtag fa-sm"></i> exam-prep</a>   <a href="/blog/tag/pentesting"> <i class="fa-solid fa-hashtag fa-sm"></i> pentesting</a>     ·   <a href="/blog/category/ctf"> <i class="fa-solid fa-tag fa-sm"></i> ctf</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>This is a walkthrough of the Kioptrix machine, based on the methodology detailed by Heath Adams in the Practical Ethical Hacking course.</p> <p>You can download the machine here: <a href="https://tcm-sec.com/kioptrix" rel="external nofollow noopener" target="_blank">https://tcm-sec.com/kioptrix</a></p> <p>I set up the machine on VirtualBox, with both Kali and Kioptrix on the same NAT network. First, let’s find the IP address of the machine using Netdiscover.</p> <div style="text-align: center; font-size: larger;"> <code style="font-family: monospace;">sudo netdiscover -i eth0</code> </div> <p>I got the IP address as 192.168.208.129.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ctf/kioptrix/kioptrix_1-480.webp 480w,/assets/img/ctf/kioptrix/kioptrix_1-800.webp 800w,/assets/img/ctf/kioptrix/kioptrix_1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/ctf/kioptrix/kioptrix_1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Now, let’s do a basic full port scan on the machine to get all the open ports.</p> <div style="text-align: center; font-size: larger;"> <code style="font-family: monospace;">nmap -p- 192.168.208.129</code> </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ctf/kioptrix/kioptrix_2-480.webp 480w,/assets/img/ctf/kioptrix/kioptrix_2-800.webp 800w,/assets/img/ctf/kioptrix/kioptrix_2-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/ctf/kioptrix/kioptrix_2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Now that we know which ports are open, we can target them exclusively for a more detailed scan to get the services running on them and their versions.</p> <div style="text-align: center; font-size: larger;"> <code style="font-family: monospace;">nmap -sC -sV -A -p22,80,111,139,443,32768 192.168.208.129</code> </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ctf/kioptrix/kioptrix_3-480.webp 480w,/assets/img/ctf/kioptrix/kioptrix_3-800.webp 800w,/assets/img/ctf/kioptrix/kioptrix_3-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/ctf/kioptrix/kioptrix_3.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>We found some interesting services and their versions on the web server on port 80, and we also found that SMB is running on port 139. But we couldn’t get the SMB version from nmap directly.</p> <p>So, we can try to use a Metasploit module to get the version of SMB.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ctf/kioptrix/kioptrix_4-480.webp 480w,/assets/img/ctf/kioptrix/kioptrix_4-800.webp 800w,/assets/img/ctf/kioptrix/kioptrix_4-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/ctf/kioptrix/kioptrix_4.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>We got the version as 2.2.1a. Let’s also try listing the shares using smbclient.</p> <div style="text-align: center; font-size: larger;"> <code style="font-family: monospace;">smbclient -L \\\\192.168.208.129</code> </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ctf/kioptrix/kioptrix_5-480.webp 480w,/assets/img/ctf/kioptrix/kioptrix_5-800.webp 800w,/assets/img/ctf/kioptrix/kioptrix_5-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/ctf/kioptrix/kioptrix_5.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>We found an interesting ADMIN share, but unfortunately could not connect to it. But we did find out that anonymous login was allowed.</p> <p>Now that we know a few of the services and versions, let’s search for any available exploits for them. We started with SMB as it has been historically known to have several vulnerabilities. And sure enough, searching for SMB 2.2 vulnerabilities on Google led me to a Metasploit exploit module which we can possibly use.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ctf/kioptrix/kioptrix_6-480.webp 480w,/assets/img/ctf/kioptrix/kioptrix_6-800.webp 800w,/assets/img/ctf/kioptrix/kioptrix_6-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/ctf/kioptrix/kioptrix_6.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>I immediately tried to use the exploit, but found that the default payload does not work.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ctf/kioptrix/kioptrix_7-480.webp 480w,/assets/img/ctf/kioptrix/kioptrix_7-800.webp 800w,/assets/img/ctf/kioptrix/kioptrix_7-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/ctf/kioptrix/kioptrix_7.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Heath Adams did mention that if a staged payload (like the default one) does not work, we should try with a non-staged payload. So I searched for the payloads compatible with this module, and found another one to try.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ctf/kioptrix/kioptrix_8-480.webp 480w,/assets/img/ctf/kioptrix/kioptrix_8-800.webp 800w,/assets/img/ctf/kioptrix/kioptrix_8-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/ctf/kioptrix/kioptrix_8.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>And sure enough, this one worked (although it asked me to enter the RHOSTS value again), and we got a root shell directly!</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ctf/kioptrix/kioptrix_9-480.webp 480w,/assets/img/ctf/kioptrix/kioptrix_9-800.webp 800w,/assets/img/ctf/kioptrix/kioptrix_9-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/ctf/kioptrix/kioptrix_9.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>There is another way to exploit this machine, without using Metasploit. That’s by exploiting a vulnerability on modssl, which we found was running on the web server from our nmap output.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ctf/kioptrix/kioptrix_10-480.webp 480w,/assets/img/ctf/kioptrix/kioptrix_10-800.webp 800w,/assets/img/ctf/kioptrix/kioptrix_10-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/ctf/kioptrix/kioptrix_10.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>The exploit directly from ExploitDB does not work, but someone did build one that works and posted it on Github, and it actually comes up as the first result on Google. The link is <a href="https://github.com/heltonWernik/OpenLuck" rel="external nofollow noopener" target="_blank">here</a>.</p> <p>We followed the instructions on the Git repo, and if we just run the compiled program by itself without mentioning any arguments, it gives us a list of options to choose from. We know we are on an Apache 1.3.20 server, so I used grep to find the option for us.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ctf/kioptrix/kioptrix_11-480.webp 480w,/assets/img/ctf/kioptrix/kioptrix_11-800.webp 800w,/assets/img/ctf/kioptrix/kioptrix_11-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/ctf/kioptrix/kioptrix_11.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Now all we had to do was run the exploit against the machine.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ctf/kioptrix/kioptrix_12-480.webp 480w,/assets/img/ctf/kioptrix/kioptrix_12-800.webp 800w,/assets/img/ctf/kioptrix/kioptrix_12-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/ctf/kioptrix/kioptrix_12.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>And we got a root shell again!</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ctf/kioptrix/kioptrix_13-480.webp 480w,/assets/img/ctf/kioptrix/kioptrix_13-800.webp 800w,/assets/img/ctf/kioptrix/kioptrix_13-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/ctf/kioptrix/kioptrix_13.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>I hope you enjoyed this walkthrough! Happy Hacking!</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/dc9/">DC 9 - Vulnhub</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/symfonos1/">Symfonos 1 - Vulnhub</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/academy/">Academy (TCM Security PEH Capstone)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/derpnstink/">DerpNStink - Vulnhub</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/djinn/">Djinn - Vulnhub</a> </li> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2024 Navaneeth Sivakumar. The views and opinions expressed here are my own. Thank you for visiting. Template adapted from <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio. </a> </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>